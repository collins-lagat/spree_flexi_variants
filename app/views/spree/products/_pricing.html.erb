<% if SpreeFlexiVariants::Config[:use_javascript_pricing_updates] %>
  <%= content_for :flexi_variants_body_js do %>

    <%# didn't use javascript_tag here so we don't confuse deface %>
    <script type="text/javascript">
      //<![CDATA[

      SpreeFlexiVariants.product.currency = "<%= @product.currency %>";
      SpreeFlexiVariants.product.basePrice = <%= @product.price %>;
      SpreeFlexiVariants.product.doesProductHaveVariants = <%= @product.has_variants? %>;

      // First I need to set up a mapping for the variants on the screen so I can easily grab their prices
      <% if @product.has_variants? %>
        <% @product.variants.active.each_with_index do |variant, index| %>
          SpreeFlexiVariants.product.variantPriceMap[<%= variant.id %>] = <%= variant.price %>;
        <% end %>
      <% end %>

      <% @product.ad_hoc_option_types.each do |product_option_type| %>
        <% product_option_type.option_values.each do |product_option_value| %>
          SpreeFlexiVariants.product.priceModifierMap[<%= product_option_value.id %>] = <%= product_option_value.price_modifier %>;
        <% end %>
      <% end %>

    //]]>
    </script>

    <%= javascript_include_tag 'spree/frontend/products/update_price', :defer => "defer" %>
  <% end %>
<% end %>
